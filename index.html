<script>
    const SECRET_CODE = "NEWMUSIC";

    const logs = [
        "INITIALIZING BOOT SEQUENCE...",
        "LOADING OS... V8.4.2",
        "CHECKING MEMORY... OK",
        "SECURE CONNECTION... ESTABLISHED",
        "DECRYPTING INTERFACE...",
        "READY."
    ];

    const logContainer = document.getElementById('boot-logs');
    let logIndex = 0;

    function runBoot() {
        if (logIndex < logs.length) {
            let p = document.createElement('div');
            p.className = 'typing';
            p.innerText = "> " + logs[logIndex];
            logContainer.appendChild(p);
            logIndex++;
            setTimeout(runBoot, 500);
        } else {
            setTimeout(() => {
                const bootScreen = document.getElementById('boot-screen');
                const loginBox = document.getElementById('login-box');
                
                if(bootScreen) bootScreen.style.opacity = '0';
                
                setTimeout(() => {
                    if(bootScreen) bootScreen.style.display = 'none';
                    if(loginBox) loginBox.style.display = 'block';
                }, 500);
            }, 800);
        }
    }

    // Standard way to start the script
    window.addEventListener('load', runBoot);

    function checkCode() {
        const input = document.getElementById('passcode').value.toUpperCase().trim();
        if (input === SECRET_CODE) {
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('player-box').style.display = 'block';
        } else {
            document.getElementById('error').innerText = "!! INVALID_CREDENTIALS !!";
        }
    }

    function playPreview(id, startTime) {
        const audio = document.getElementById(id);
        const status = document.getElementById('status-msg');
        
        // Stop and reset all other audio
        document.querySelectorAll('audio').forEach(el => {
            el.pause();
            el.currentTime = 0;
            el.oncanplay = null;
            el.volume = 1.0;
        });

        status.innerText = "> INITIALIZING DATA STREAM...";

        const startPlayback = () => {
            audio.currentTime = startTime;
            audio.volume = 1.0;
            
            audio.play().then(() => {
                status.innerText = "> PLAYING ENCRYPTED DATA...";
                
                setTimeout(() => {
                    let fadeOut = setInterval(() => {
                        if (audio.volume > 0.1) {
                            audio.volume -= 0.1;
                        } else {
                            clearInterval(fadeOut);
                            audio.pause();
                            audio.volume = 1.0; 
                            status.innerText = "> END_OF_PREVIEW";
                        }
                    }, 100); 
                }, 4000); 
            }).catch(e => {
                status.innerText = "> ERROR: INTERACTION REQUIRED";
                console.log("Audio play blocked:", e);
            });
        };

        // Mobile Fix: ReadyState check
        if (audio.readyState >= 2) {
            startPlayback();
        } else {
            audio.oncanplay = () => {
                startPlayback();
                audio.oncanplay = null;
            };
            audio.load(); 
        }
    }
</script>
